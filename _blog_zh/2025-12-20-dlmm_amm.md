---
title: "DLMM VS AMM"
date: 2025-12-20
category: "Blockchain & Web3"
excerpt: "AMM vs DLMM：它们如何定价与撮合交易、LP 如何赚取手续费，以及离散化流动性为何常常比常数乘积池更高效。"
header:
  teaser: "foo-bar-identity.jpg"
  overlay_image: "foo-bar-identity.jpg"
  fullscreen: true
---

## TL;DR

- **AMM（例如 Uniswap v2）**：价格曲线是连续的（常见为常数乘积 $$\(x \cdot y = k\)$$）。体验简单、可组合性强，但 LP 资金会“铺”在所有价格区间 → **同样 TVL 下滑点更大**、很多市场里 **手续费收益密度更低**。
- **DLMM（例如 Trader Joe Liquidity Book / Meteora DLMM）**：把流动性放到**离散的价格箱（bins）**里。交易先消耗**当前活跃 bin**，当该 bin 一侧流动性被吃完就会**跳到相邻 bin**继续成交 → **资本效率更高**，但做 LP 更偏**策略/管理型**，价格走出你的 bins 后可能只剩“单边资产”。

---

## 1) 什么是 AMM？它是如何工作的（含项目例子）

**自动做市商（AMM, Automated Market Maker）**是一类基于智能合约的交易机制：价格由一条**数学规则（不变量 / invariant）**决定，而不是像订单簿那样撮合买卖盘。

### 经典 AMM：常数乘积池

最经典、也最容易理解的 AMM（由 **Uniswap v2** 推广开来）会维护两种代币的储备量：

- \(x\)：池子里 token A 的数量  
- \(y\)：池子里 token B 的数量

并尽量满足：

\[
x \cdot y = k
\]

当你用 A 去换 B 时，A 的储备 \(x\) 增加，为了让 \(k\) 维持不变（考虑手续费后近似成立），B 的储备 \(y\) 必然减少。沿着这条曲线移动会带来两个典型现象：

- **滑点（Slippage）**：交易额相对流动性越大，你的平均成交价越差。
- **价格冲击（Price impact）**：你的交易会改变池子的报价。

### AMM 的“价格”从哪里来

在常数乘积池里，瞬时（边际）价格可以用储备比例来理解：

\[
P_{A \rightarrow B} \approx \frac{y}{x}
\]

随着交易发生，\(x\) 与 \(y\) 持续变化，因此价格会在曲线上**连续地**变化。

### LP 如何赚钱

LP（流动性提供者）通常需要按比例存入两种资产（例如 ETH + USDC），获得 LP 份额，并按份额分享：

- **交易手续费**（例如每笔 0.3%，具体取决于池子/协议）

但 LP 也要承受**无常损失（IL, Impermanent Loss）**：当市场价格波动时，AMM 会自动把 LP 的仓位“再平衡”（卖出涨得多的、买入跌得多的），因此可能跑输“单纯持币不动”。

### 项目例子：Uniswap v2

**Uniswap v2**是常数乘积 AMM 的代表。很多 DEX 聚合器的路径里也经常会路由到 v2 风格池子。

v2 风格 AMM 的典型特征：

- **一条连续曲线**覆盖所有价格
- **偏被动的 LP**（不需要选范围）
- **机制简单稳健**（可组合性强、数学清晰）

---

## 2) 什么是 DLMM？它是如何工作的（含项目例子）

**DLMM**通常指**离散化流动性做市（Discretized Liquidity Market Maker）**：与把资金铺在一条连续曲线上不同，DLMM 把流动性分配到**离散的价格桶/箱（bins）**里。

你可以把它理解为：把“集中流动性”的思想做得更显式 —— 用一组离散的价格网格来表达。

### 核心概念：bins + 活跃价格 bin

DLMM 会定义一系列价格 bins（用 \(i\) 索引）。每个 bin 代表一个价格点（或一个很小的价格区间）。常见参数化形式：

\[
P_i = P_0 (1+\delta)^i
\]

其中：

- \(P_0\) 是参考价格
- \(\delta\) 是 bin 的步长（例如 0.01%、0.05%、0.1%……）

系统任意时刻会有一个**活跃 bin（active bin）**作为当前“市场”价格所在的 bin。流动性按 bin 存储，因此每个 bin 都有各自的储备 \((x_i, y_i)\)。

### DLMM 的交易如何执行（逐 bin 成交）

常见的执行逻辑是：

- 交易先以该 bin 的价格，**消耗活跃 bin**中的流动性
- 如果交易量足够大，导致活跃 bin 的某一侧被吃完，交易就会**移动到下一个 bin**（价格更高或更低）继续成交

因此价格路径会呈现**分段/阶梯状**：

- 在同一个 bin 内，价格近似**不变**（具体取决于实现）
- 跨 bin 时，价格会按步长 \(\delta\) **离散跳动**

直觉上：

- **活跃 bin 里流动性越深** ⇒ 小额交易的滑点越小  
- **活跃 bin 周围被填充的 bins 越多** ⇒ 大额交易越容易“顺滑”成交（减少流动性断层）

### LP 如何提供流动性（策略是第一等公民）

在 DLMM 中，LP 往往需要选择把资金放在哪些 bins 上：

- **铺得更宽（很多 bins）**：更被动、更像 v2，但资本效率更低  
- **铺得更窄（靠近活跃价的少量 bins）**：手续费密度更高、更高效，但更容易“脱离范围”  
- **单边/非对称**：部分 DLMM 设计让你更容易在某些 bins 上偏单边提供

这也是为什么 DLMM 做 LP 更像“运行一个策略”，而不是“存进去就放着”。

### 项目例子：Trader Joe Liquidity Book（LB）

**Trader Joe 的 Liquidity Book（LB）**是知名的 DLMM 实现之一（最初在 Avalanche 上广泛使用，也扩展到多链）。

它的核心直觉就是：

- 流动性围绕活跃价分布在**多个 bins**里
- 交易按 **bin-by-bin** 执行
- LP 可以选择不同的 **bin 分布形状**（窄/宽/自定义），对应不同风险收益

### 项目例子：Meteora DLMM（Solana）

在 Solana 上，**Meteora 的 DLMM**也属于广泛使用的离散化流动性设计。

如果你在 UI 里看到“bins / 策略 / 动态费率”等表述，基本就是 DLMM 的典型心智模型：把资金放到你认为会发生交易的价格附近，通过流量穿过这些 bins 来赚取手续费。

---

## 3) DLMM vs AMM：差异点、优缺点与适用场景

先避免一个常见歧义：很多人把所有“非订单簿 DEX”都叫 AMM。本文中：

- **AMM** = 经典连续曲线池（如 v2 风格常数乘积）
- **DLMM** = 离散 bins + 活跃 bin 执行

### 机制差异一览

| 维度 | AMM（v2 风格） | DLMM（bin 风格） |
|---|---|---|
| **定价方式** | 连续曲线（如 \(x\cdot y=k\)） | 离散价格 bins（网格） |
| **成交方式** | 沿曲线平滑移动 | 先吃活跃 bin，再逐 bin 跳转 |
| **流动性摆放** | 天生覆盖所有价格 | LP 需要选 bins/范围 |
| **资本效率** | 较低（大量资金远离现价“闲置”） | 靠近现价可很高（前提是摆放合理） |
| **LP 管理成本** | 低（更被动） | 中到高（策略与再平衡很关键） |
| **同 TVL 下滑点** | 通常更高 | 现价附近通常更低 |
| **风险形态** | 简单、相对均匀 | 更依赖价格路径与策略选择 |

### AMM（v2 风格）的优缺点

- **优点**
  - **心智模型简单**：存两种资产 → 赚手续费  
  - **可组合性强**：不变量数学被大量 DeFi 协议复用  
  - **更被动**：不用管理范围  
  - **流动性“永远在线”**：任何价格附近都能成交（只是越成交越差）

- **缺点**
  - **资本效率偏低**：资金摊到很多几乎用不到的价格区间  
  - **同 TVL 下滑点更大**（尤其是波动大的币对）  
  - **无常损失不可避免**：需要手续费/激励覆盖 IL 才可能正收益

### DLMM 的优缺点

- **优点**
  - **资本效率更高**：资金集中在真正发生交易的位置  
  - **现价附近执行更好**：更小滑点/更紧“价差”  
  - **策略空间大**：可塑形分布、非对称布局等  
  - 很多实现会配合更贴合波动与流量的**费率机制**（取决于协议）

- **缺点**
  - **更依赖策略**：收益高度取决于 bins 选择与再平衡频率  
  - **脱离范围风险**：价格走远后，你的 bins 可能不再产生手续费  
  - **仓位更容易偏单边**：趋势行情后可能主要持有某一种资产（可视作一种 IL/再平衡结果）  
  - **参数更多**：步长、范围、策略会提升使用门槛与“策略风险”

### 实用建议：什么时候选哪个？

- **如果你是交易者**
  - **AMM（v2 风格）**：适合长尾资产与简单路径，但薄流动性池子里更容易出现大滑点  
  - **DLMM**：当现价附近 bins 填得足够深时，往往有更好的成交；但要关注 bin 之外的深度与是否存在“断层”

- **如果你是 LP**
  - 想要**省心**：偏向 **AMM（v2 风格）**（接受效率较低）  
  - 愿意**做管理/用策略**：偏向 **DLMM**（追求更高费率密度）

### 一个快速直觉清单

- **高波动 + 有持续成交量**：DLMM 往往更有优势（但前提是策略能跟上价格）  
- **低成交量或价格不确定性很强**：v2 风格可能更稳妥（不押注某个窄区间）  
- **稳定币对**：两者都能做；离散/集中类设计通常更高效，但要看费率、激励、活跃流动性与实际做市形态

---

## 总结

AMM 用“数学定价”让链上交易变得极其简单；DLMM 更进一步，把流动性显式拆成离散 bins，通常能提升资本效率，但也把更多收益/风险交给 LP 的策略选择与管理。

只记住一句话就够了：**AMM 是“一条曲线覆盖所有人”，DLMM 是“很多 bins 由你来选”。**
